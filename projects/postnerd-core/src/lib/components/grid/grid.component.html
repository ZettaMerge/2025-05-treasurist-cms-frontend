<!-- *libSkeleton="loadingSub; type: 'table'" -->
<!-- <pn-grid-per-page
  [page]="page"
  (setPerPage)="setPerPage($event)"
></pn-grid-per-page> -->

<ngx-datatable
  #dataTable
  [style.height]="bodyHeightCalculate"
  [loadingIndicator]="loading"
  [ngClass]="['material', gridClass]"
  [columnMode]="'force'"
  [scrollbarV]="scrollbarV"
  [scrollbarH]="scrollbarH"
  [virtualization]="false"
  [rows]="filteredRows"
  [columns]="gridTableColumns"
  [headerHeight]="headerHeight"
  [footerHeight]="footerHeight"
  [summaryRow]="enableSummary"
  [summaryHeight]="summaryHeight"
  [summaryPosition]="summaryPosition"
  [rowHeight]="rowHeight"
  [rowClass]="rowClass"
  [reorderable]="false"
  [rowIdentity]="rowIdentity"
  [groupRowsBy]="groupRowsBy"
  [groupExpansionDefault]="groupExpansionDefault"
  [selected]="selected"
  [selectionType]="selectionType"
  [selectCheck]="selectCheck"
  [displayCheck]="displayCheck"
  (select)="onSelect($event)"
  [externalPaging]="externalPaging"
  [count]="count()"
  [offset]="offset()"
  [limit]="limit()"
  (page)="setPage($event)"
  [externalSorting]="externalSorting"
  [sorts]="sorts()"
  (sort)="onSort($event)"
  [selectAllRowsOnPage]="selectAllRowsOnPage"
>
  <ngx-datatable-group-header *ngIf="groupRowsBy">
    <ng-template
      let-group="group"
      let-expanded="expanded"
      ngx-datatable-group-header-template
    >
      <ng-container
        *ngIf="groupRowsTemplate else groupRowsDefaultTemplate"
        [ngTemplateOutlet]="groupRowsTemplate"
        [ngTemplateOutletContext]="{ group: group, expanded: expanded, groupHeader: dataTable.groupHeader }"
      >
      </ng-container>

      <ng-template #groupRowsDefaultTemplate>
        <div class="_group-rows-default-template">
          <b>{{ group.key }}</b>
        </div>
      </ng-template>
    </ng-template>

    <!-- Group Rows Custom Template Example -->
    <!--
      <ng-template
        #groupRowsTemplate
        let-group="group"
        let-expanded="expanded"
        let-groupHeader="groupHeader"
      >
        <div style="padding-left:5px;">
          <a
            [class.datatable-icon-right]="!expanded"
            [class.datatable-icon-down]="expanded"
            title="Expand/Collapse Group"
            (click)="groupHeader.toggleExpandGroup(group)"
          >
            <b>Color: {{ group.value[0].color }}</b>
          </a>
        </div>
      </ng-template>
    -->
  </ngx-datatable-group-header>

  <ngx-datatable-footer>
    <ng-template
      ngx-datatable-footer-template
      let-rowCount="rowCount"
      let-pageSize="pageSize"
      let-selectedCount="selectedCount"
      let-curPage="curPage"
      let-offset="offset"
    >
      <div class="page-count">
        <div class="d-inline-block font-size-normal text-muted">
          แสดงรายการที่ {{(offset * pageSize) + 1}} ถึง
          {{(curPage * pageSize) > rowCount ? rowCount : curPage * pageSize }} จากทั้งหมด
          {{ rowCount?.toLocaleString() }}
          รายการ
        </div>
        <!-- <pn-per-page-dropdown
          *ngIf="page"
          [list]="perPageOptions"
          [(ngModel)]="page.perPage"
          (ngModelChange)="setPerPage($event)"
        >
        </pn-per-page-dropdown> -->
        <!-- <div
          class="select is-vertical-baseline"
          *ngIf="page"
        >
          <select (change)="setPerPage($event.target.value)">
            <option
              *ngFor="let perPageOption of perPageOptions"
              [value]="perPageOption"
              [selected]="perPageOption == page.perPage"
            >
              {{ perPageOption }} per page
            </option>
          </select>
        </div> -->
      </div>
      <!--
      [pagerPreviousIcon]="'datatable-icon-prev'"
        [pagerNextIcon]="'datatable-icon-skip'"
        [pagerLeftArrowIcon]="'datatable-icon-left'"
        [pagerRightArrowIcon]="'datatable-icon-right'"
       -->
      <datatable-pager
        [pagerLeftArrowIcon]="'ic-chevron-left'"
        [pagerRightArrowIcon]="'ic-chevron-right'"
        [pagerPreviousIcon]="'ft-chevrons-left'"
        [pagerNextIcon]="'ft-chevrons-right'"
        [page]="page?.page || curPage"
        [size]="pageSize"
        [count]="rowCount"
        (change)="dataTable.onFooterPage($event)"
      >
      </datatable-pager>


    </ng-template>
  </ngx-datatable-footer>
</ngx-datatable>

<!-- header template -->
<pn-lib-grid-header-wrapper #headerWrapper>
  <ng-template
    #contentTemplate
    let-column
  >
  </ng-template>
</pn-lib-grid-header-wrapper>

<pn-lib-grid-header-wrapper #noFilterHeaderWrapper>
  <ng-template
    #contentTemplate
    let-column
  >
    <div class="control">
    </div>
  </ng-template>
</pn-lib-grid-header-wrapper>

<pn-lib-grid-header-wrapper #searchableHeaderWrapper>
  <ng-template
    #contentTemplate
    let-column
  >
    <div class="control">
      <input
        type="text"
        class="input"
        placeholder="{{ column.placeholder }}"
        [ngModel]="filter[column.prop]"
        (input)="onSearch(column, $event.target.value)"
        (select)="$event.stopPropagation()"
      />
    </div>
  </ng-template>
</pn-lib-grid-header-wrapper>

<pn-lib-grid-header-wrapper #datePickerHeaderWrapper>
  <ng-template
    #contentTemplate
    let-column
  >
    <div class="control">
      <lib-date-picker
        [(ngModel)]="filter[column.prop]"
        (ngModelChange)="onFilter(column)"
      ></lib-date-picker>
    </div>
  </ng-template>
</pn-lib-grid-header-wrapper>

<pn-lib-grid-header-wrapper #dateRangePickerHeaderWrapper>
  <ng-template
    #contentTemplate
    let-column
  >
    <div class="control">
      <lib-date-range-picker
        [(ngModel)]="filter[column.prop]"
        (ngModelChange)="onFilter(column)"
      ></lib-date-range-picker>
    </div>
  </ng-template>
</pn-lib-grid-header-wrapper>

<pn-lib-grid-header-wrapper #monthPickerHeaderWrapper>
  <ng-template
    #contentTemplate
    let-column
  >
    <div class="control">
      <lib-date-picker
        [monthOnly]="true"
        [format]="'YYYY MMMM'"
        [(ngModel)]="filter[column.prop]"
        (ngModelChange)="onFilter(column)"
      ></lib-date-picker>
    </div>
  </ng-template>
</pn-lib-grid-header-wrapper>

<pn-lib-grid-header-wrapper #inputNumberRangeHeaderWrapper>
  <ng-template
    #contentTemplate
    let-column
  >
    <div class="control">
      <lib-input-number-range-popover
        [(ngModel)]="filter[column.prop]"
        (ngModelChange)="onFilter(column)"
      ></lib-input-number-range-popover>
    </div>
  </ng-template>
</pn-lib-grid-header-wrapper>

<pn-lib-grid-header-wrapper #booleanHeaderWrapper>
  <ng-template
    #contentTemplate
    let-column
  >
    <div class="control">
      <div class="select is-fullwidth">
        <select
          [(ngModel)]="filter[column.prop]"
          (change)="onFilter(column)"
        >
          <option [ngValue]="undefined">All</option>
          <option [ngValue]="true">True</option>
          <option [ngValue]="false">False</option>
        </select>
      </div>
    </div>
  </ng-template>
</pn-lib-grid-header-wrapper>

<!-- cell template -->

<ng-template
  #dateTpl
  let-value="value"
>
  {{ !value ? '-' : value | aDate }}
</ng-template>

<ng-template
  #dateTimeTpl
  let-value="value"
>
  <div *ngIf="value"> {{ value | aDateTime }}น.</div>
  <div *ngIf="!value">-</div>

</ng-template>

<ng-template
  #dateNumberTpl
  let-value="value"
>
  <div *ngIf="value"> {{ value | date: 'dd/MM/yyyy' }}</div>
  <div *ngIf="!value">-</div>

</ng-template>

<ng-template
  #timeTpl
  let-value="value"
>
  {{ value | aTime }}
</ng-template>

<ng-template
  #integerTpl
  let-value="value"
>
  <div class="text-right">
    {{ value | anInteger }}
  </div>
</ng-template>

<ng-template
  #decimalTpl
  let-value="value"
>
  <div class="text-right" *ngIf="value">
    {{ value | aDecimal }}
  </div>
  <div class="text-right" *ngIf="!value">
    {{ '-' }}
  </div>
</ng-template>

<ng-template
  #unitTpl
  let-value="value"
>
  <div class="text-right" *ngIf="value">
    {{ value | aDecimal : 4}}
  </div>
  <div *ngIf="!value">-</div>
</ng-template>

<ng-template
  #percentTpl
  let-value="value"
>
  <div class="text-right">
    {{value}}%
  </div>
</ng-template>

<ng-template
  #percentWithDecimalTpl
  let-value="value"
>
  <div class="text-right">
    {{value | aDecimal}}%
  </div>
</ng-template>

<ng-template
  #reOrderTpl
  let-value="value"
>
  <div class="d-flex justify-content-around align-items-center">
    <span class="reorder-handle text-strong">
      <span></span>
      <span></span>
      <span></span>
    </span>
  </div>
</ng-template>

<ng-template
  #checkMarkTpl
  let-value="value"
>
  <div class="text-center">
    {{ value ? '✓' : '' }}
  </div>
</ng-template>

<ng-template
  #colorTpl
  let-value="value"
>
  <div class="_color-wrapper">
    {{ value }}
    <div
      class="_color"
      [ngStyle]="{'background-color': value}"
    ></div>
  </div>
</ng-template>

<ng-template
  #actionTpl
  let-row="row"
>
  <div class="buttons d-flex justify-content-between align-items-center">
    <a
      ngbTooltip="ลบ"
      container="body"
      class="_action-btn _delete-btn"
      (click)="delete.emit(row)"
    >
      <i class="ic ic-delete"></i>
    </a>
    <a
      class="_action-btn _edit-btn"
      ngbTooltip="แก้ไข"
      container="body"
      (click)="edit.emit(row)"
    >
      <i class="ic ic-note-edit "></i>
    </a>
  </div>
</ng-template>

<ng-template
  #actionEditTpl
  let-row="row"
>
  <div class="d-flex justify-content-around align-items-center">
    <a
      ngbTooltip="แก้ไข"
      container="body"
      class="_action-btn _edit-btn"
      (click)="edit.emit(row)"
    >
      <i class="ic ic-note-edit"></i>
    </a>
  </div>
</ng-template>

<ng-template
  #actionDeleteTpl
  let-row="row"
>
  <div class="d-flex justify-content-around align-items-center">
    <a
      ngbTooltip="ลบ"
      container="body"
      class="_action-btn _delete-btn"
      (click)="delete.emit(row)"
    >
      <i class="ic ic-trash"></i>
    </a>
  </div>
</ng-template>

<ng-template
  #actionWithDetailTpl
  let-row="row"
>
  <div class="buttons d-flex justify-content-between align-items-center">
    <a
      ngbTooltip="ลบ"
      container="body"
      class="_action-btn _delete-btn"
      (click)="delete.emit(row)"
    >
      <i class="ic ic-delete"></i>
    </a>
    <a
      class="_action-btn _edit-btn"
      ngbTooltip="แก้ไข"
      container="body"
      (click)="edit.emit(row)"
    >
      <i class="ic ic-note-edit "></i>
    </a>
    <a
      ngbTooltip="รายละเอียด"
      container="body"
      class="_action-btn _detail-btn"
      (click)="detailInfo.emit(row)"
    >
      <i class="ic ic-eye-circle"></i>
    </a>
  </div>
</ng-template>

<ng-template
  #detailTpl
  let-row="row"
>
  <div class="buttons d-flex justify-content-between align-items-center">
    <a
      ngbTooltip="รายละเอียด"
      container="body"
      class="_action-btn _detail-btn"
      (click)="detailInfo.emit(row)"
    >
      <i class="ic ic-eye-circle"></i>
    </a>
  </div>
</ng-template>

<ng-template
  #editAndSaveDraftTpl
  let-row="row"
>
  <div class="buttons d-flex justify-content-between align-items-center">
    <a
      ngbTooltip="รายละเอียด"
      container="body"
      class="_action-btn _detail-btn"
      (click)="detailInfo.emit(row)"
    >
      <i class="ic ic-eye-circle"></i>
    </a>
    <a
      class="_action-btn _edit-btn"
      ngbTooltip="แก้ไข"
      container="body"
      (click)="edit.emit(row)"
    >
      <i class="ic ic-note-edit "></i>
    </a>
  </div>
</ng-template>

<ng-template
  #valueTpl
  let-row="row"
  let-value="value"
>
  {{value ? value : '-'}}
</ng-template>
